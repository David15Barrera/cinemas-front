<div class="max-w-7xl mx-auto p-3 sm:p-4 md:p-6">
  <!-- Botón de regresar y Título con nombre del cine -->
  <div class="mb-6">
    <button 
      (click)="_router.navigate(['/client/catalog'])" 
      class="btn btn-ghost btn-sm gap-2 mb-4"
    >
      <i-lucide [img]="ArrowLeft" class="w-4 h-4"></i-lucide>
      Regresar a Cines
    </button>
    
    <h2 class="text-xl sm:text-2xl font-bold flex items-center gap-2" style="color: var(--fallback-bc, oklch(var(--bc)));">
      <i-lucide [img]="Film" class="w-5 h-5 sm:w-6 sm:h-6 text-primary"></i-lucide>
      Funciones Disponibles en <span class="text-primary ml-2">{{ cinemaName || 'Cine no especificado' }}</span>
    </h2>
  </div>

  <!-- Sección de Filtros -->
  <div class="mb-6">
    <!-- Botón para mostrar/ocultar filtros -->
    <div class="flex items-center justify-between mb-4">
      <button 
        (click)="toggleFilters()" 
        class="btn btn-outline btn-sm gap-2"
      >
        <i-lucide [img]="Filter" class="w-4 h-4"></i-lucide>
        {{ showFilters ? 'Ocultar Filtros' : 'Mostrar Filtros' }}
      </button>
      
      <button 
        *ngIf="hasActiveFilters()" 
        (click)="clearFilters()"
        class="btn btn-ghost btn-sm gap-2 text-error"
      >
        <i-lucide [img]="X" class="w-4 h-4"></i-lucide>
        Limpiar Filtros
      </button>
    </div>

    <!-- Panel de Filtros -->
    <div *ngIf="showFilters" class="card bg-base-200 shadow-lg mb-6">
      <div class="card-body p-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          
          <!-- Filtro por Fecha -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">
                <i-lucide [img]="Calendar" class="w-4 h-4 inline mr-2"></i-lucide>
                Fecha
              </span>
            </label>
            <select 
              [(ngModel)]="filters.selectedDate" 
              (change)="applyFilters()"
              class="select select-bordered w-full"
            >
              <option value="">Todas las fechas</option>
              <option *ngFor="let date of availableDates" [value]="date">
                {{ formatDateLabel(date) }} - {{ date | date:'dd/MM/yyyy' }}
              </option>
            </select>
          </div>

          <!-- Filtro por Horario -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">
                <i-lucide [img]="Clock" class="w-4 h-4 inline mr-2"></i-lucide>
                Horario
              </span>
            </label>
            <select 
              [(ngModel)]="filters.selectedTime" 
              (change)="applyFilters()"
              class="select select-bordered w-full"
            >
              <option value="">Todos los horarios</option>
              <option value="morning">{{ timeRanges.morning.label }}</option>
              <option value="afternoon">{{ timeRanges.afternoon.label }}</option>
              <option value="evening">{{ timeRanges.evening.label }}</option>
              <option value="night">{{ timeRanges.night.label }}</option>
            </select>
          </div>

        </div>

        <!-- Indicador de resultados -->
        <div class="mt-4 text-sm opacity-70">
          Mostrando {{ filteredShowTimes.length }} de {{ showTimes.length }} funciones
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay funciones -->
  <div *ngIf="filteredShowTimes.length === 0" class="alert alert-info">
    <i-lucide [img]="AlertCircle" class="w-5 h-5"></i-lucide>
    <span>
      {{ hasActiveFilters() 
        ? 'No hay funciones disponibles con los filtros seleccionados.' 
        : 'No hay funciones disponibles en este momento.' 
      }}
    </span>
  </div>

  <!-- Grid de tarjetas de funciones -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">
    <div *ngFor="let showTime of filteredShowTimes" class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
      <ng-container *ngIf="showTime.movie">
        <!-- Poster de la película -->
        <figure class="px-0 pt-0 h-64 overflow-hidden bg-gray-200">
          <img 
            [src]="showTime.movie.posterUrl | image" 
            [alt]="showTime.movie.title"
            class="w-full h-full object-cover"
          >
        </figure>
        <div class="card-body p-4">
          <!-- Título de la película -->
          <h3 class="card-title text-base sm:text-lg line-clamp-2 min-h-[3rem]">
            {{ showTime.movie.title }}
          </h3>
          <!-- Clasificación y Duración -->
          <div class="flex flex-wrap items-center gap-2 mb-2">
            <div class="badge badge-primary badge-sm">
              {{ showTime.movie.classification }}
            </div>
            <div class="flex items-center gap-1 text-xs opacity-70">
              <i-lucide [img]="Clock" class="w-3 h-3"></i-lucide>
              <span>{{ showTime.movie.durationMinutes }} min</span>
            </div>
          </div>
          <!-- Sinopsis -->
          <p class="text-xs sm:text-sm opacity-70 line-clamp-3 mb-3 min-h-[3.6rem]">
            {{ showTime.movie.synopsis }}
          </p>
          <!-- Información de la función -->
          <div class="space-y-2 border-t border-base-300 pt-3">
            <!-- Sala -->
            <div class="flex items-center gap-2">
              <i-lucide [img]="Monitor" class="w-4 h-4 text-primary"></i-lucide>
              <div class="flex-1">
                <p class="text-xs opacity-60">Sala</p>
                <p class="text-sm font-semibold">{{ showTime.nameRoom }}</p>
              </div>
            </div>
            <!-- Horario -->
            <div class="flex items-center gap-2">
              <i-lucide [img]="Calendar" class="w-4 h-4 text-green-600"></i-lucide>
              <div class="flex-1">
                <p class="text-xs opacity-60">Horario</p>
                <p class="text-sm font-semibold">{{ showTime.startTime | date:'dd/MM/yyyy HH:mm' }}</p>
              </div>
            </div>
            <!-- Precio -->
            <div class="flex items-center gap-2">
                <div class="flex-1">
                    <p class="text-xs text-gray-500">Precio</p>
                    <p class="text-lg font-bold text-success">Q {{ showTime.price | number:'1.2-2' }}</p>
                </div>
            </div>
          </div>
          <!-- Botón de compra -->
          <div class="card-actions justify-end mt-4">
            <button 
              (click)="buyTicket(showTime)" 
              class="btn btn-primary btn-sm w-full gap-2"
            >
              <i-lucide [img]="ShoppingCart" class="w-4 h-4"></i-lucide>
              ¡Comprar!
            </button>
          </div>
        </div>
      </ng-container>
      <!-- Skeleton loader mientras carga la película -->
      <ng-container *ngIf="!showTime.movie">
        <div class="animate-pulse">
          <div class="bg-base-300 h-64 w-full"></div>
          <div class="card-body p-4 space-y-3">
            <div class="h-6 bg-base-300 rounded w-3/4"></div>
            <div class="h-4 bg-base-300 rounded w-1/2"></div>
            <div class="h-3 bg-base-300 rounded"></div>
            <div class="h-3 bg-base-300 rounded"></div>
            <div class="h-3 bg-base-300 rounded w-5/6"></div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>